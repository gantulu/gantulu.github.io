<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Daftar Pesanan</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  .order { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
  .order h3 { margin: 0 0 10px; }
  .section { margin-bottom: 10px; padding: 10px; border: 1px solid #eee; border-radius: 5px; background: #f9f9f9; }
  .section h4 { margin: 0 0 5px; font-size: 14px; color: #333; }
  .item { display: flex; align-items: center; margin-bottom: 10px; }
  .item img { width: 60px; height: 60px; object-fit: cover; margin-right: 10px; border-radius: 5px; }
  .item-details { display: flex; flex-direction: column; font-size: 14px; }
  .order p { margin: 2px 0; font-size: 14px; }
  pre { background: #f0f0f0; padding: 10px; overflow-x: auto; font-size: 12px; }
  #searchOrderID, #filterLatest { margin-bottom: 20px; padding: 8px; width: 300px; font-size: 14px; margin-right: 10px; }
</style>
</head>
<body>
<h1>Daftar Pesanan</h1>
<input type="text" id="searchOrderID" placeholder="Cari Order ID...">
<button id="filterLatest">Tampilkan Terbaru</button>
<div id="orders"></div>

<script>
function formatRupiah(angka) {
  return angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
}

let allOrders = [];

async function loadOrders() {
  const response = await fetch('https://opensheet.elk.sh/1UegN4GjZZeZHEierW_dqIfkRZpTwZKb6tQW4YQ85mFw/Sheet1');
  allOrders = await response.json();
  displayOrders(allOrders);
}

function displayOrders(orders) {
  const ordersContainer = document.getElementById('orders');
  ordersContainer.innerHTML = '';

  orders.forEach(order => {
    const orderDiv = document.createElement('div');
    orderDiv.className = 'order';

    orderDiv.innerHTML = `
      <h3>Order ID: ${order.orderID}</h3>

      <div class="section">
        <h4>Data Pelanggan</h4>
        <p><strong>Nama:</strong> ${order.nama}</p>
        <p><strong>Email:</strong> ${order.email}</p>
        <p><strong>WhatsApp:</strong> ${order.whatsapp}</p>
        <p><strong>Alamat:</strong> ${order.alamat}</p>
      </div>

      <div class="section">
        <h4>Metode & Pembayaran</h4>
        <p><strong>Metode Pengiriman:</strong> ${order.metodePengiriman}</p>
        <p><strong>Metode Pembayaran:</strong> ${order.metodePembayaran}</p>
        <p><strong>Nomor VA:</strong> ${order.nomorVA}</p>
      </div>

      <div class="section">
        <h4>Checkout</h4>
        <p><strong>Checkout Total:</strong> Rp ${formatRupiah(order.checkoutTotal)}</p>
        <p><strong>Biaya Pengiriman:</strong> Rp ${formatRupiah(order.biayaPengiriman)}</p>
        <p><strong>Total Checkout + Ongkir:</strong> Rp ${formatRupiah(order.totalBiayaCheckoutPengiriman)}</p>
      </div>

      <div class="section">
        <h4>Items</h4>
      </div>
    `;

    const itemsSection = document.createElement('div');
    itemsSection.className = 'section';

    const items = JSON.parse(order.checkoutItems);
    items.forEach(item => {
      const itemDiv = document.createElement('div');
      itemDiv.className = 'item';
      itemDiv.innerHTML = `
        <img src="${item.image_link}" alt="${item.title}">
        <div class="item-details">
          <strong>${item.title}</strong>
          <span>Price: Rp ${formatRupiah(item.price)}</span>
          <span>Color: ${item.color}, Size: ${item.size}</span>
          <span>Brand: ${item.brand}, Gender: ${item.gender}</span>
        </div>
      `;
      itemsSection.appendChild(itemDiv);
    });

    orderDiv.appendChild(itemsSection);

    const rawItems = document.createElement('pre');
    rawItems.textContent = order.checkoutItems;
    orderDiv.appendChild(rawItems);

    ordersContainer.appendChild(orderDiv);
  });
}

// Search by Order ID
document.getElementById('searchOrderID').addEventListener('input', function() {
  const searchTerm = this.value.toLowerCase();
  const filteredOrders = allOrders.filter(order => order.orderID.toLowerCase().includes(searchTerm));
  displayOrders(filteredOrders);
});

// Filter latest orders
document.getElementById('filterLatest').addEventListener('click', function() {
  const sortedOrders = [...allOrders].reverse();
  displayOrders(sortedOrders);
});

loadOrders();
</script>
</body>
</html>
