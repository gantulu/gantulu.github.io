<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Detail Produk - Oncloud</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, 
    maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* shimmer animation */
    .skeleton {
      position: relative;
      overflow: hidden;
      background: #e5e7eb;
    }
    .skeleton::after {
      content: "";
      position: absolute;
      top: 0; left: -150px;
      height: 100%; width: 150px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
      animation: shimmer 1.2s infinite;
    }
    @keyframes shimmer {
      100% { transform: translateX(100%); }
    }
  </style>
</head>
<body class="bg-gray-50 text-[15px] leading-relaxed md:text-base">

  <!-- Header -->
  <header class="flex items-center justify-between p-4 md:p-6 border-b bg-white">
    <div class="text-base md:text-lg font-semibold">oncloudstore.id</div>
    <div class="flex gap-4 text-lg md:text-xl">
      <button>üîç</button>
      <button>‚ò∞</button>
    </div>
  </header>

  <!-- Gambar Produk -->
  <section class="flex justify-center bg-white">
    <div id="imageSkeleton" class="w-80 h-80 md:w-96 md:h-96 skeleton rounded"></div>
    <img id="mainImage" src="" alt="Produk" 
         class="w-80 h-80 md:w-96 md:h-96 object-cover transition hidden" />
  </section>

  <!-- Nama, Gender & Harga -->
  <section class="p-5 md:p-6 bg-white border-b">
    <h1 id="productTitle" class="text-xl md:text-2xl font-bold skeleton h-6 w-48 mb-3"></h1>
    <p id="productGender" class="text-sm md:text-base text-gray-500 mt-2 skeleton h-4 w-32"></p>
    <div class="flex items-center gap-2 mt-3">
      <span id="productPrice" class="skeleton h-4 w-16"></span>
      <span id="productSalePrice" class="skeleton h-5 w-20"></span>
      <span id="productDiscount" class="skeleton h-4 w-10"></span>
    </div>
  </section>

  <!-- Variant Warna -->
  <section class="p-5 md:p-6 bg-white border-b">
    <p id="variantLabel" class="text-sm md:text-base text-gray-500 mb-3">Varian Warna:</p>
    <div id="variantList" class="flex gap-3">
      <div class="w-12 h-12 rounded skeleton"></div>
      <div class="w-12 h-12 rounded skeleton"></div>
      <div class="w-12 h-12 rounded skeleton"></div>
    </div>
  </section>

  <!-- Variant Size -->
  <section class="p-5 md:p-6 bg-white border-b">
    <p id="sizeLabel" class="text-sm md:text-base text-gray-500 mb-3">Varian Size:</p>
    <div id="sizeList" class="flex flex-wrap gap-3">
      <div class="px-6 py-2 rounded-full skeleton"></div>
      <div class="px-6 py-2 rounded-full skeleton"></div>
      <div class="px-6 py-2 rounded-full skeleton"></div>
    </div>
  </section>

  <!-- Tombol CTA -->
  <section class="p-5 md:p-6 bg-white border-b">
    <div id="ctaSkeleton" class="w-full py-4 rounded-xl skeleton"></div>
    <a id="productLink" href="#"
       class="hidden block w-full bg-blue-600 text-white py-4 md:py-5 rounded-xl font-semibold text-lg md:text-xl text-center shadow hover:bg-blue-700 transition">
      Checkout Sekarang
    </a>
  </section>

  <!-- Info Produk -->
  <section class="p-5 md:p-6 bg-white border-b">
    <h2 class="font-semibold text-lg md:text-xl mb-3">Info produk</h2>
    <p id="productDesc" class="skeleton h-16 w-full"></p>
  </section>

  <!-- Sebelumnya Dilihat -->
  <section class="p-5 md:p-6 bg-white border-b">
    <h2 class="font-semibold text-lg md:text-xl mb-3">Sebelumnya dilihat</h2>
    <div id="relatedProducts" class="grid grid-cols-2 gap-4">
      <div class="h-40 rounded skeleton"></div>
      <div class="h-40 rounded skeleton"></div>
      <div class="h-40 rounded skeleton"></div>
      <div class="h-40 rounded skeleton"></div>
    </div>
  </section>

  <script>
    const sheetUrl = "https://opensheet.elk.sh/1Q0AFC9pzYSgZn6aeaRihKN113sMG72NKakTaDTSxtk8/Sheet1";

    const sizeOptions = [
      "40","40.5","41","42","42.5","43","44","44.5",
      "45","46","47","47.5","48","48.5","49","50"
    ];

    let selectedProduct = null;
    let selectedSize = sizeOptions[0];

    async function loadProduct() {
      const res = await fetch(sheetUrl);
      const data = await res.json();

      const urlParams = new URLSearchParams(window.location.search);
      const groupId = urlParams.get("itmid");

      const variants = data.filter(item => item.item_group_id === groupId);

      if (variants.length > 0) {
        selectedProduct = variants[0];
        updateProduct(selectedProduct);

        // Varian Warna
        const variantList = document.getElementById("variantList");
        variantList.innerHTML = "";
        variants.forEach((v, index) => {
          const thumb = document.createElement("div");
          thumb.className = "w-12 h-12 border rounded overflow-hidden cursor-pointer";
          thumb.innerHTML = `<img src="${v.image_link}" alt="${v.color}" class="w-full h-full object-cover">`;

          if (index === 0) thumb.classList.add("border-blue-500");

          thumb.addEventListener("click", () => {
            selectedProduct = v;
            updateProduct(v);

            document.querySelectorAll("#variantList div").forEach(el => {
              el.classList.remove("border-blue-500");
              el.classList.add("border");
            });
            thumb.classList.add("border-blue-500");
          });

          variantList.appendChild(thumb);
        });

        // Varian Size
        const sizeList = document.getElementById("sizeList");
        sizeList.innerHTML = "";
        sizeOptions.forEach((size, idx) => {
          const btn = document.createElement("button");
          btn.className = "px-3 py-1 border rounded-full text-sm cursor-pointer hover:bg-gray-100 bg-white text-gray-800";
          btn.innerText = size;

          if (idx === 0) {
            btn.classList.add("bg-blue-600", "text-white");
            document.getElementById("sizeLabel").innerText = "Varian Size: " + size;
          }

          btn.addEventListener("click", () => {
            selectedSize = size;
            document.querySelectorAll("#sizeList button").forEach(b => {
              b.classList.remove("bg-blue-600", "text-white");
              b.classList.add("bg-white", "text-gray-800");
            });
            btn.classList.add("bg-blue-600", "text-white");
            document.getElementById("sizeLabel").innerText = "Varian Size: " + size;
            updateCTA();
          });

          sizeList.appendChild(btn);
        });

        // Produk terkait
        const related = data.filter(item => item.item_group_id !== groupId);
        renderRelatedProducts(related.slice(0, 4));

        // Hapus skeleton setelah data siap
        document.getElementById("imageSkeleton").classList.add("hidden");
        document.getElementById("mainImage").classList.remove("hidden");

        document.getElementById("ctaSkeleton").classList.add("hidden");
        document.getElementById("productLink").classList.remove("hidden");

        document.getElementById("productTitle").classList.remove("skeleton");
        document.getElementById("productGender").classList.remove("skeleton");
        document.getElementById("productPrice").classList.remove("skeleton");
        document.getElementById("productSalePrice").classList.remove("skeleton");
        document.getElementById("productDiscount").classList.remove("skeleton");
        document.getElementById("productDesc").classList.remove("skeleton");
      }
    }

    function updateProduct(v) {
      const price = "Rp" + Number(v.price).toLocaleString("id-ID");
      const sale = "Rp" + Number(v.sale_price).toLocaleString("id-ID");

      document.getElementById("mainImage").src = v.image_link;
      document.getElementById("productTitle").innerText = v.title;
      document.getElementById("productGender").innerText = "Gender: " + (v.gender || "-");
      document.getElementById("productPrice").innerText = price;
      document.getElementById("productSalePrice").innerText = sale;
      document.getElementById("productDiscount").innerText = v.discount ? "(" + v.discount + ")" : "";
      document.getElementById("productDesc").innerText = v.description;
      document.getElementById("variantLabel").innerText = "Varian Warna: " + v.color;

      updateCTA();
    }

    function updateCTA() {
      if (selectedProduct) {
        const params = new URLSearchParams({
          image_link: selectedProduct.image_link,
          title: selectedProduct.title,
          gender: selectedProduct.gender,
          sale_price: selectedProduct.sale_price,
          color: selectedProduct.color,
          size: selectedSize
        });

        document.getElementById("productLink").href = "./checkout.html?" + params.toString();
      }
    }

    function renderRelatedProducts(products) {
      const container = document.getElementById("relatedProducts");
      container.innerHTML = "";
      products.forEach(p => {
        const card = document.createElement("a");
        card.href = `produk.html?itmid=${p.item_group_id}`;
        card.className = "block border rounded-lg overflow-hidden bg-white shadow-sm hover:shadow-md transition";

        card.innerHTML = `
          <img src="${p.image_link}" alt="${p.title}" class="w-full h-32 object-cover">
          <div class="p-2">
            <h3 class="text-sm font-semibold truncate">${p.title}</h3>
            <p class="text-pink-600 text-sm font-bold">Rp${Number(p.sale_price).toLocaleString("id-ID")}</p>
          </div>
        `;
        container.appendChild(card);
      });
    }

    loadProduct();
  </script>
</body>
</html>
