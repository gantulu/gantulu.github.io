<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Crypto Dashboard - Live</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gradient-to-b from-[#0d1422] to-[#0b1220] text-slate-200 font-sans min-h-screen p-4">

<div class="max-w-md mx-auto">
  <!-- Tabs -->
  <div class="flex gap-2 mb-4">
    <button class="tab px-4 py-2 rounded-full flex-1 border border-white/10 text-slate-400" data-coin="bitcoin">BTC</button>
    <button class="tab px-4 py-2 rounded-full flex-1 border border-white/10 text-slate-400" data-coin="litecoin">LTC</button>
    <button class="tab px-4 py-2 rounded-full flex-1 border border-white/10 text-slate-400" data-coin="ethereum">ETH</button>
  </div>

  <!-- Price Cards -->
  <div class="flex gap-3 mb-3">
    <div class="flex-1 bg-white/5 rounded-xl p-3">
      <h3 id="leftAmount" class="text-lg font-semibold">$-</h3>
      <small id="leftLabel" class="text-slate-400">Loading...</small>
    </div>
    <div class="flex-1 bg-white/5 rounded-xl p-3">
      <h3 id="rightAmount" class="text-lg font-semibold">$-</h3>
      <small id="rightLabel" class="text-slate-400">Loading...</small>
    </div>
  </div>

  <!-- Chart -->
  <div class="bg-white/5 rounded-xl p-4 shadow-lg mb-4">
    <div class="flex justify-between items-center mb-2">
      <div id="chartTitle" class="font-semibold">Bitcoin</div>
      <div id="chartChange" class="text-slate-400 text-sm">-</div>
    </div>
    <canvas id="mainChart" height="200"></canvas>
  </div>

  <!-- Mini Row -->
  <div class="grid grid-cols-2 gap-3 mini-row">
    <!-- Litecoin -->
    <div class="bg-white/5 rounded-xl p-3">
      <div class="label text-sm text-slate-400">Litecoin</div>
      <div class="value text-sm mb-1 flex items-center gap-2">
        <span id="ltcPrice">$-</span>
        <span id="ltcChange">-</span>
      </div>
      <canvas id="mini1" height="100"></canvas>
    </div>

    <!-- Ripple -->
    <div class="bg-white/5 rounded-xl p-3">
      <div class="label text-sm text-slate-400">Ripple</div>
      <div class="value text-sm mb-1 flex items-center gap-2">
        <span id="xrpPrice">$-</span>
        <span id="xrpChange">-</span>
      </div>
      <canvas id="mini2" height="100"></canvas>
    </div>
  </div>
</div>

<script>
const ctx = document.getElementById('mainChart').getContext('2d');
let mainChart = new Chart(ctx, {
  type: 'line',
  data: { labels: [], datasets: [{ data: [], borderColor: '#60a5fa', backgroundColor: 'rgba(96,165,250,0.2)', fill: true, tension: 0.35, pointRadius: 0 }]},
  options: { plugins:{legend:{display:false}}, scales:{x:{display:false}, y:{ticks:{color:'#9ca3af'}}}}
});

// helper mini chart
function createMiniChart(id,color) {
  return new Chart(document.getElementById(id).getContext('2d'), {
    type: 'line',
    data: { labels: [], datasets:[{ data: [], borderColor: color, backgroundColor: color.replace('1)', '0.2)'), fill:true, tension:0.35, pointRadius:0 }]},
    options: { plugins:{legend:{display:false}, tooltip:{enabled:false}}, scales:{x:{display:false}, y:{display:false}}}
  });
}
let miniLTC = createMiniChart("mini1","rgba(125,211,252,1)");
let miniXRP = createMiniChart("mini2","rgba(148,163,184,1)");

// cache last API data
let mainData = [], ltcData = [], xrpData = [];
let currentCoin = "bitcoin";

// API fetch
async function fetchCoin(coin="bitcoin") {
  const res = await fetch(`https://api.coingecko.com/api/v3/coins/${coin}?localization=false&sparkline=true`);
  const data = await res.json();
  
  document.getElementById("leftAmount").textContent = `$${data.market_data.current_price.usd.toLocaleString()}`;
  document.getElementById("leftLabel").textContent = data.name;
  document.getElementById("rightAmount").textContent = `$${data.market_data.market_cap.usd.toLocaleString()}`;
  document.getElementById("rightLabel").textContent = "Market Cap";

  mainData = data.market_data.sparkline_7d.price;
  mainChart.data.labels = mainData.map((_,i)=>i);
  mainChart.data.datasets[0].data = [...mainData];
  mainChart.update();

  document.getElementById("chartTitle").textContent = data.name;
  const change = data.market_data.price_change_percentage_24h;
  document.getElementById("chartChange").textContent = `${change.toFixed(2)}%`;
  document.getElementById("chartChange").className = change >= 0 ? "text-green-400 text-sm" : "text-red-400 text-sm";
}

async function fetchMini(coin, chart, priceEl, changeEl, cache) {
  const res = await fetch(`https://api.coingecko.com/api/v3/coins/${coin}?localization=false&sparkline=true`);
  const data = await res.json();
  const price = data.market_data.current_price.usd;
  const change = data.market_data.price_change_percentage_24h;

  document.getElementById(priceEl).textContent = `$${price.toLocaleString()}`;
  document.getElementById(changeEl).textContent = `${change>=0?"▲":"▼"} ${Math.abs(change).toFixed(2)}%`;
  document.getElementById(changeEl).className = change>=0 ? "text-green-400 text-xs" : "text-red-400 text-xs";

  cache.length = 0;
  cache.push(...data.market_data.sparkline_7d.price);
  chart.data.labels = cache.map((_,i)=>i);
  chart.data.datasets[0].data = [...cache];
  chart.update();
}

// fake tick update (1s, random jitter)
function liveTick() {
  function jitter(data, chart) {
    if (!data.length) return;
    let last = data[data.length-1];
    let next = last * (1 + (Math.random()-0.5)/200); // ±0.25%
    data.push(next);
    if (data.length > 100) data.shift();
    chart.data.labels = data.map((_,i)=>i);
    chart.data.datasets[0].data = [...data];
    chart.update();
  }
  jitter(mainData, mainChart);
  jitter(ltcData, miniLTC);
  jitter(xrpData, miniXRP);
}

// Tabs
document.querySelectorAll(".tab").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    document.querySelectorAll(".tab").forEach(b=>b.classList.remove("bg-white/10","text-white"));
    btn.classList.add("bg-white/10","text-white");
    currentCoin = btn.dataset.coin;
    fetchCoin(currentCoin);
  });
});

// Init
fetchCoin("bitcoin");
fetchMini("litecoin", miniLTC, "ltcPrice", "ltcChange", ltcData);
fetchMini("ripple", miniXRP, "xrpPrice", "xrpChange", xrpData);
document.querySelector('.tab[data-coin="bitcoin"]').classList.add("bg-white/10","text-white");

// Interval
setInterval(()=>fetchCoin(currentCoin),10000); // tiap 10 detik refresh API main
setInterval(()=>fetchMini("litecoin", miniLTC, "ltcPrice", "ltcChange", ltcData),10000);
setInterval(()=>fetchMini("ripple", miniXRP, "xrpPrice", "xrpChange", xrpData),10000);
setInterval(liveTick,1000); // tiap 1 detik update lokal
</script>
</body>
</html>
