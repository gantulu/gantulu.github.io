<form id="uploadForm">
  <label>Pilih Item:
    <select id="itemSelect">
      <option value="">Memuat data...</option>
    </select>
  </label><br /><br />
  
  <label>Gambar 1: <input type="file" id="img1" /></label><br />
  <label>Gambar 2: <input type="file" id="img2" /></label><br />
  <label>Gambar 3: <input type="file" id="img3" /></label><br /><br />
  
  <button type="submit">Upload dan Update CMS</button>
</form>

<script>
const API_TOKEN = "3301b9f154f11de19dd0e574df67254bb4ef7511f74b069d4ec29b2c4371f6c5"; // üîÅ Ganti dengan token Webflow
const COLLECTION_ID = "6808c4010c2dfac0e89d885c"; // üîÅ Ganti dengan collection ID

// üîÉ Ambil item dari Webflow
async function fetchItems() {
  const res = await fetch(`https://api.webflow.com/v2/collections/${COLLECTION_ID}/items`, {
    headers: { Authorization: `Bearer ${API_TOKEN}` }
  });
  const data = await res.json();
  const select = document.getElementById("itemSelect");

  select.innerHTML = "";
  data.items.forEach(item => {
    const option = document.createElement("option");
    option.value = item._id;
    option.textContent = item.fieldData.name || item._id;
    select.appendChild(option);
  });
}

fetchItems();

// üì§ Upload 1 file ke Webflow Assets
async function uploadToWebflow(file) {
  const formData = new FormData();
  formData.append("file", file);

  const upload = await fetch("https://api.webflow.com/v2/assets/upload", {
    method: "POST",
    headers: { Authorization: `Bearer ${API_TOKEN}` },
    body: formData
  });

  return await upload.json(); // return { fileId, url }
}

// üß† Saat Submit
document.getElementById("uploadForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const itemId = document.getElementById("itemSelect").value;
  if (!itemId) return alert("Pilih item terlebih dahulu!");

  const file1 = document.getElementById("img1").files[0];
  const file2 = document.getElementById("img2").files[0];
  const file3 = document.getElementById("img3").files[0];

  const [res1, res2, res3] = await Promise.all([
    uploadToWebflow(file1),
    uploadToWebflow(file2),
    uploadToWebflow(file3)
  ]);

  // üîÅ PATCH ke Webflow CMS
  const patch = await fetch(`https://api.webflow.com/v2/collections/${COLLECTION_ID}/items/${itemId}/live?skipInvalidFiles=true`, {
    method: "PATCH",
    headers: {
      Authorization: `Bearer ${API_TOKEN}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      isArchived: false,
      isDraft: false,
      fieldData: {
        image1: { fileId: res1.fileId, url: res1.url },
        image2: { fileId: res2.fileId, url: res2.url },
        image3: { fileId: res3.fileId, url: res3.url }
      }
    })
  });

  const final = await patch.json();
  console.log("Final result:", final);
  alert("Sukses upload dan update CMS!");
});
</script>
